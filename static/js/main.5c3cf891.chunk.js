(this["webpackJsonpare-we-green-on-azure-yet"]=this["webpackJsonpare-we-green-on-azure-yet"]||[]).push([[0],{38:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n(0),r=n.n(s),a=n(24),i=n.n(a),o=(n(38),n(20)),l=n.n(o),u=n(25),d=n(10),j=n(7),h=n(16),f=n(9),b=n(28),p=n(32),m=n(13),O=n(26),g=n(8),x=n(29),k=n(27),v=n(22),y=n(15),z=n(21),w=n.n(z),I={completed:"check-circle",failed:"times-circle",exception:"exclamation-circle",pending:"spinner",running:"cog"},N={completed:"green",failed:"red",exception:"orange",pending:"gray",running:"darkgray"},S=["gecko-t/win7-32-azure","gecko-t/win7-32-gpu-azure","gecko-t/win10-64-azure","gecko-t/win10-64-gpu-azure"];var G=function(){var e=Object(s.useState)(!0),t=Object(f.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)([]),i=Object(f.a)(a,2),o=i[0],z=i[1],G=Object(s.useState)({}),C=Object(f.a)(G,2),E=C[0],L=C[1],D=Object(s.useState)([]),F=Object(f.a)(D,2),T=F[0],Y=F[1],_=Object(s.useState)({}),M=Object(f.a)(_,2),B=M[0],J=M[1],P=Object(s.useState)(["jmaher@mozilla.com","mcornmesser@mozilla.com","rthijssen@mozilla.com"]),q=Object(f.a)(P,2),A=q[0],H=q[1],K=Object(s.useState)(14),Q=Object(f.a)(K,2),R=Q[0],U=Q[1];function V(){return(V=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(s.useEffect)((function(){A&&A.length&&R&&(z([]),A.forEach((function(e){var t=w()().add(0-R,"days").format("YYYY-MM-DD");fetch("https://hg.mozilla.org/try/json-pushes?full=1&startdate=".concat(t,"&user=").concat(e)).then((function(e){return e.json()})).then((function(n){var c=Object.keys(n);console.log("checking ".concat(c.length," pushes by ").concat(e.split("@")[0]," since ").concat(t)),c.filter((function(e){return"try_task_config.json"===n[e].changesets[0].files[0]})).forEach((function(t){fetch("https://firefox-ci-tc.services.mozilla.com/api/index/v1/tasks/gecko.v2.try.pushlog-id.".concat(t)).then((function(e){if(e.ok)return e.json();throw e})).then((function(c){if(c.tasks&&c.tasks.length){var s=c.tasks[0].taskId;z((function(e){return[].concat(Object(h.a)(e.filter((function(e){return e!==s}))),[s])})),L((function(e){return Object(j.a)(Object(j.a)({},e),{},Object(d.a)({},s,Object(j.a)(Object(j.a)({},n[t]),{},{pushId:t})))})),console.log("mapped task group: ".concat(s,", to push: ").concat(t,", by: ").concat(e.split("@")[0]))}else console.log("no tasks from push: ".concat(t," by: ").concat(e.split("@")[0]))})).catch((function(e){console.error(e)}))}))})).catch((function(e){console.error(e)}))})))}),[A,R]),Object(s.useEffect)((function(){o&&o.length&&Y((function(e){return e.filter((function(e){return o.includes(e.taskGroupId)}))})),o.forEach((function(e){fetch("https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task-group/".concat(e,"/list")).then((function(e){if(e.ok)return e.json();throw e})).then((function(t){Y((function(n){return[].concat(Object(h.a)(n.filter((function(t){return t.taskGroupId!==e}))),Object(h.a)(t.tasks.filter((function(e){return S.includes("".concat(e.task.provisionerId,"/").concat(e.task.workerType))})).map((function(e){return{taskId:e.status.taskId,taskGroupId:e.task.taskGroupId,name:e.task.metadata.name,suite:e.task.metadata.name.split("/")[1],pool:"".concat(e.task.provisionerId,"/").concat(e.task.workerType),state:e.status.state,resolved:e.status.runs&&e.status.runs.length?e.status.runs.slice(-1)[0].resolved:void 0}}))))}))})).catch((function(e){console.error(e)})).finally((function(){r(!1)}))}))}),[o]),Object(s.useEffect)((function(){J((function(e){return Object(j.a)(Object(j.a)({},e),T.reduce((function(e,t){var n=t.suite;return Object(j.a)(Object(j.a)({},e),{},Object(d.a)({},n,S.reduce((function(e,t){return Object(j.a)(Object(j.a)({},e),{},Object(d.a)({},t,T.filter((function(e){return e.suite===n&&e.pool===t}))))}),{})))}),{}))}))}),[T]),Object(c.jsxs)(O.a,{children:[Object(c.jsx)("h1",{className:"text-center",children:"is the grass greener on the azure side?"}),n?Object(c.jsx)("div",{className:"text-center",children:Object(c.jsx)(k.a,{animation:"border",size:"lg"})}):null,Object(c.jsx)("h2",{className:"text-muted text-center",children:"tl;dr"}),Object(c.jsx)(v.a,{children:S.sort().map((function(e){return Object(c.jsxs)("tbody",{children:[Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"text-right",style:{width:"50%"},children:Object(c.jsx)("h6",{children:e.split("/")[1].replace("-azure","")})}),Object(c.jsx)("td",{style:{width:"50%"},children:Object.keys(B).map((function(t){var n=T.filter((function(n){return n.suite===t&&n.pool===e})).sort((function(e,t){return e.resolved<t.resolved?-1:e.resolved>t.resolved?1:0}));return!!n.length&&"completed"===n.slice(-1)[0].state})).includes(!1)?Object(c.jsx)("h6",{style:{color:"red"},children:"no"}):Object(c.jsx)("h6",{style:{color:"green"},children:"yes"})})]}),Object(c.jsx)("tr",{className:"text-center",children:Object(c.jsx)("td",{colSpan:"2",children:Object.keys(N).map((function(t){return Object(c.jsxs)(p.a,{style:{marginLeft:"0.3em"},variant:"outline-secondary",size:"sm",children:[Object(c.jsx)(y.a,{style:{margin:"0 1px"},className:["pending","running"].includes(t)?"fa-sm fa-spin":"fa-sm",icon:I[t],color:N[t]}),"\xa0",Object(c.jsxs)(b.a,{variant:"secondary",children:[Object.keys(B).map((function(t){var n=T.filter((function(n){return n.suite===t&&n.pool===e})).sort((function(e,t){return e.resolved<t.resolved?-1:e.resolved>t.resolved?1:0}));return n.length?n.slice(-1)[0].state:void 0})).filter((function(e){return e===t})).length," / ",Object.keys(B).filter((function(t){return!!T.filter((function(n){return n.suite===t&&n.pool===e})).length})).length]})]},t)}))})})]},e)}))}),Object(c.jsx)("h2",{className:"text-muted text-center",children:"detail"}),Object(c.jsxs)(v.a,{striped:!0,size:"sm",children:[Object(c.jsx)("thead",{children:Object(c.jsxs)("tr",{children:[Object(c.jsx)("th",{className:"text-muted text-right",children:"suite"}),S.sort().map((function(e){return Object(c.jsx)("th",{className:"text-muted text-center",children:e.split("/")[1].replace("-azure","")},e)}))]})}),Object(c.jsx)("tbody",{children:Object.keys(B).sort().map((function(e){return Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"text-right",children:e}),S.sort().map((function(t){return Object(c.jsx)("td",{className:"text-center",children:B[e][t].sort((function(e,t){return e.resolved<t.resolved?-1:e.resolved>t.resolved?1:0})).slice(-5).map((function(e){return Object(c.jsx)("a",{href:"https://firefox-ci-tc.services.mozilla.com/tasks/".concat(e.taskId),target:"_blank",rel:"noreferrer",title:"".concat(E[e.taskGroupId].user.split("@")[0]," (try/").concat(E[e.taskGroupId].pushId,"): pushed: ").concat(w()(1e3*E[e.taskGroupId].date).toISOString()," resolved: ").concat(e.resolved),children:Object(c.jsx)(y.a,{style:{margin:"0 1px"},className:["pending","running"].includes(e.state)?"fa-sm fa-spin":"fa-sm",icon:I[e.state],color:N[e.state]})},e.taskId)}))},t)}))]},e)}))})]}),Object(c.jsx)(g.a,{onSubmit:function(e){return V.apply(this,arguments)},children:Object(c.jsxs)(x.a,{children:[Object(c.jsx)(m.a,{children:Object(c.jsxs)(g.a.Group,{children:[Object(c.jsx)(g.a.Label,{children:"include try pushes by"}),Object(c.jsx)(g.a.Control,{type:"text",value:A.join(", "),onChange:function(e){var t=e.target.value;H(t.split(",").map((function(e){return e.trim()})))}})]})}),Object(c.jsx)(m.a,{xs:!0,lg:"2",children:Object(c.jsxs)(g.a.Group,{children:[Object(c.jsx)(g.a.Label,{children:"push age in days"}),Object(c.jsx)(g.a.Control,{type:"number",value:R,onChange:function(e){var t=parseInt(e.target.value);t>-1&&t<31&&U(t)}})]})})]})}),Object(c.jsxs)("ul",{children:[Object(c.jsxs)("li",{children:["status legend:",Object.keys(N).map((function(e){return Object(c.jsxs)("div",{children:[Object(c.jsx)(y.a,{style:{margin:"0 1px"},className:["pending","running"].includes(e)?"fa-sm fa-spin":"fa-sm",icon:I[e],color:N[e]}),"\xa0",e]},e)}))]}),Object(c.jsx)("li",{className:"text-muted",children:"task status counts, in the tl;dr table, are determined by the last task run for the test suite and platform."}),Object(c.jsx)("li",{className:"text-muted",children:"task status indicators, in the detail table, are limited to the five most recent task runs for the test suite and platform."}),Object(c.jsxs)("li",{className:"text-muted",children:["the try push-log is used to find task groups containing tasks that are configured to run on azure worker types for pushes in the last ",R," days, from a configured subset of users including: ",A.map((function(e){return e.split("@")[0]})).join(", "),"."]}),Object(c.jsxs)("li",{children:["the code for this github page is hosted at: ",Object(c.jsx)("a",{href:"https://github.com/mozilla-platform-ops/are-we-green-on-azure-yet",children:"github.com/mozilla-platform-ops/are-we-green-on-azure-yet"}),"."]}),Object(c.jsxs)("li",{children:["the work to green up tests is tracked in: ",Object(c.jsx)("a",{href:"https://bugzilla.mozilla.org/show_bug.cgi?id=1676850",children:"bug 1676850"}),"."]})]})]})},C=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,49)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),c(e),s(e),r(e),a(e)}))},E=(n(47),n(12)),L=n(30),D=n(31);E.b.add(L.a,D.a),i.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(G,{})}),document.getElementById("root")),C()}},[[48,1,2]]]);
//# sourceMappingURL=main.5c3cf891.chunk.js.map